---
title: Data manipulation
author: Fiona Seaton
date: 2018-10-09

draft: false
toc: false
type: docs

linktitle: Data manipulation
menu:
  tutorial:
    parent: R club
    weight: 2
---



<p>This is a tutorial I wrote for R club on data manipulation and exploration. There’s several different ways of doing the same operation given, largely so that in future if you see one of them you know what is happening.</p>
<p>First of all we need to load up the packages we want to use today</p>
<pre class="r"><code>library(readr)   ## for reading in data
library(dplyr)   ## for manipulating dataframes
library(tidyr)   ## for conversion from wide to long format
## alternatively use library(tidyverse) which contains dplyr, readr, tidyr and more
library(janitor) ## for data cleaning tools
library(psych)   ## for some useful data exploration graphs
library(summarytools) ## for some summary statistics and tables</code></pre>
<p>Now I’m going to read in the data from the working directory, this data represents a simulated field survey across three countries of soil properties. I’m using read_csv here from the readr package to read in the csv file, its behaviour is slightly different than read.csv in base R. For instance character strings are kept as characters, not converted to factors which many people dislike about base R (I’ve found the vast majority of my data that comes as characters is categorical so it’s not such an issue for me). It can also deal better with non-standard column names, which is why I’m using it here to show one of the cool things janitor does. The output is a tibble which displays different behaviour when printed to console Later on we’ll read in a file using read.csv and you’ll see some differences</p>
<pre class="r"><code>CS &lt;- read_csv(&quot;CS_fake.csv&quot;)
CS</code></pre>
<pre><code>## # A tibble: 1,000 x 7
##    `Plot ID`  Country County    `Carbon (%)` `Nitrogen (%)`    ph Habitat
##    &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;          &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;
##  1 GCEXWQRYRK VAL     ERROLD            70.2           7.70  2.85       8
##  2 JZCMAHEPQY RET     BOLTHAVEN         14.5           1.53  6.04       7
##  3 DTVGQBSJIA VAL     TREVALE           28.6           5.93  5.00       4
##  4 REJAJMVEIE HAR     GREENVALE         24.0           1.64  5.43       2
##  5 FMWEYMKIGS VAL     EVENDIM           14.9           2.84  6.85       8
##  6 KYULXCMWOJ VAL     EVENDIM           57.8           6.89  3.17       6
##  7 CPKKYGMVFP RET     PETRAS            33.3           4.53  4.55       7
##  8 TAYSUFTDEF RET     PETRAS            56.0           8.01  3.05       5
##  9 EAYSCYXEST VAL     ERROLD            12.3           5.18  5.97       6
## 10 NZONLIZVZK VAL     EVENDIM           74.5          10.0   2.54       9
## # ... with 990 more rows</code></pre>
<p>We can see that many of the columns have rather ugly names, which we’re going to deal with using the clean_names function in janitor</p>
<pre class="r"><code>CS &lt;- clean_names(CS)
colnames(CS)</code></pre>
<pre><code>## [1] &quot;plot_id&quot;          &quot;country&quot;          &quot;county&quot;          
## [4] &quot;carbon_percent&quot;   &quot;nitrogen_percent&quot; &quot;ph&quot;              
## [7] &quot;habitat&quot;</code></pre>
<p>You can change the way in which janitor converts the names by changing the case argument. My personal favourite is screaming snake but that’s mainly because of the delightful mental image.</p>
<div id="subsetting-data" class="section level2">
<h2>Subsetting data</h2>
<p>Using base R In base R the square bracket notation is used for subsetting, e.g. data[3,1] means the 3rd row and 1st column of the data</p>
<pre class="r"><code>CS[3,1]</code></pre>
<pre><code>## # A tibble: 1 x 1
##   plot_id   
##   &lt;chr&gt;     
## 1 DTVGQBSJIA</code></pre>
<p>Use the arrows to assign a new object, selecting all the rows but only certain columns. Columns can be selected by their numbers:</p>
<pre class="r"><code>CS_sel &lt;- CS[,1:3]
CS_sel &lt;- CS[,c(1:3,5)]</code></pre>
<p>Columns can also be selected by their names</p>
<pre class="r"><code>CS_sel &lt;- CS[,c(&quot;plot_id&quot;,&quot;ph&quot;)]</code></pre>
<p>There is also the subset function</p>
<pre class="r"><code>CS_sel &lt;- subset(CS, select = c(plot_id, ph))</code></pre>
<p>Alternatively the select`function within dplyr can be used to only pick some columns</p>
<pre class="r"><code>CS_sel &lt;- select(CS, plot_id, carbon_percent, nitrogen_percent)
CS_sel &lt;- select(CS, plot_id, country:county)</code></pre>
<p>select() has a couple of helper functions which can be used to select multiple columns that have certain parts of their names in common, this can also be done in base R with regular expressions but it’s a bit clunky</p>
<pre class="r"><code>CS_sel &lt;- select(CS, starts_with(&quot;count&quot;))

## base R version
CS_sel &lt;- CS[,grepl(&quot;^count&quot;,colnames(CS))]</code></pre>
<pre class="r"><code>## by row number
CS_fil &lt;- CS[1:100,]

## by value of variable
## only sites from HAR (categorical variable)
CS_fil &lt;- CS[CS$country == &quot;HAR&quot;,]
CS_fil &lt;- subset(CS, country == &quot;HAR&quot;)
CS_fil &lt;- filter(CS, country == &quot;HAR&quot;)       ##dplyr

## only carbon rich soils (numeric variable)
CS_fil &lt;- CS[CS$carbon_percent &gt; 50,]
CS_fil &lt;- filter(CS, carbon_percent &gt; 50)       ##dplyr
## difference due to NA handling

## two criteria
## only high carbon soils from HAR
CS_fil &lt;- CS[(CS$carbon_percent &gt; 50 &amp; CS$country == &quot;HAR&quot;),]  
CS_fil &lt;- filter(CS, carbon_percent &gt; 50 &amp; country == &quot;HAR&quot;) ##dplyr

## Har and Val soils
CS_fil &lt;- CS[(CS$country==&quot;HAR&quot; | CS$country==&quot;VAL&quot;),]
CS_fil &lt;- filter(CS, country == &quot;HAR&quot;|country == &quot;VAL&quot;)     ##dplyr</code></pre>
</div>
<div id="altering-variables" class="section level2">
<h2>Altering variables</h2>
<p>convert from number to categorical (i.e. factor) and vice versa</p>
<pre class="r"><code>CS$habitat &lt;- as.factor(CS$habitat)
summary(CS$habitat)</code></pre>
<pre><code>##   1   2   3   4   5   6   7   8   9  10 
##  95 107  95 109 106  99 106  99 105  79</code></pre>
<pre class="r"><code># And back again!
CS$habitat &lt;- as.numeric(as.character(CS$habitat))</code></pre>
<p>create new variable based on current variable numeric to factor</p>
<pre class="r"><code>CS$C_CAT &lt;- cut(CS$carbon_percent, c(0,10,30,50,100),
                labels=c(&quot;Mineral&quot;,&quot;Humus-mineral&quot;, &quot;Organo-mineral&quot;,&quot;Organic&quot;))
CS</code></pre>
<pre><code>## # A tibble: 1,000 x 8
##    plot_id country county carbon_percent nitrogen_percent    ph habitat
##    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;            &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1 GCEXWQ~ VAL     ERROLD           70.2             7.70  2.85       8
##  2 JZCMAH~ RET     BOLTH~           14.5             1.53  6.04       7
##  3 DTVGQB~ VAL     TREVA~           28.6             5.93  5.00       4
##  4 REJAJM~ HAR     GREEN~           24.0             1.64  5.43       2
##  5 FMWEYM~ VAL     EVEND~           14.9             2.84  6.85       8
##  6 KYULXC~ VAL     EVEND~           57.8             6.89  3.17       6
##  7 CPKKYG~ RET     PETRAS           33.3             4.53  4.55       7
##  8 TAYSUF~ RET     PETRAS           56.0             8.01  3.05       5
##  9 EAYSCY~ VAL     ERROLD           12.3             5.18  5.97       6
## 10 NZONLI~ VAL     EVEND~           74.5            10.0   2.54       9
## # ... with 990 more rows, and 1 more variable: C_CAT &lt;fct&gt;</code></pre>
<p>change labels of factor variable</p>
<pre class="r"><code>levels(CS$C_CAT)</code></pre>
<pre><code>## [1] &quot;Mineral&quot;        &quot;Humus-mineral&quot;  &quot;Organo-mineral&quot; &quot;Organic&quot;</code></pre>
<pre class="r"><code>levels(CS$C_CAT) &lt;- c(&quot;M&quot;,&quot;HM&quot;,&quot;OM&quot;,&quot;O&quot;)
summary(CS$C_CAT)</code></pre>
<pre><code>##    M   HM   OM    O NA&#39;s 
##   13  446  380  156    5</code></pre>
<pre class="r"><code>CS$C_CAT &lt;- recode_factor(CS$C_CAT, 
                          &quot;O&quot; = &quot;Org&quot;)      ##dplyr

summary(CS$C_CAT)</code></pre>
<pre><code>##  Org    M   HM   OM NA&#39;s 
##  156   13  446  380    5</code></pre>
</div>
<div id="converting-from-wide-to-long-format-and-vice-versa" class="section level2">
<h2>Converting from wide to long format (and vice versa)</h2>
<p>Read in the data using the base R function read.csv</p>
<pre class="r"><code>CS_INV &lt;- read.csv(&quot;CS_inverts.csv&quot;)
str(CS_INV)</code></pre>
<pre><code>## &#39;data.frame&#39;:    1000 obs. of  9 variables:
##  $ ID   : Factor w/ 1000 levels &quot;AARNOEIXTK&quot;,&quot;AASEUFESNB&quot;,..: 247 393 153 675 221 422 98 751 166 539 ...
##  $ MITE1: int  3 5 2 2 0 0 5 5 0 0 ...
##  $ MITE2: int  2 2 0 0 4 2 0 0 2 3 ...
##  $ MITE3: int  0 0 5 0 3 12 0 1 4 1 ...
##  $ MITE4: int  0 1 1 0 3 0 0 1 1 0 ...
##  $ COLL1: int  1 0 0 0 0 2 1 0 0 2 ...
##  $ COLL2: int  3 0 2 0 5 1 2 1 0 2 ...
##  $ COLL3: int  8 3 0 0 7 8 2 0 19 4 ...
##  $ COLL4: int  4 3 1 0 10 1 2 2 2 1 ...</code></pre>
<p>Notice that we’re now using str to see the data’s structure - if we were to print CS_INV to screen it would try and print out every row of the data. This is because read.csv reads the data in as a data.frame not a tibble.</p>
<p>This dataset represents counts of different types of mites and collembola from the soil samples. (This is all still simulated, no mesofauna were harmed in the making of this tutorial)</p>
<p>The data is in wide format. Wide format means we have one sample (or site) per row, with multiple measurements across multiple columns. Long format is when we have the results of each measurement in one column, with a second column identifying the type of measurement. If this isn’t particularly clear wait until you see the output of the following code and it should make more sense.</p>
<p>We’re using the gather function from the tidyr package to convert the wide format data into long format.The reshape2 package also has functions to do this however I’ve discovered that my brain appears to max out at understanding one way to do it. Many use reshape2 and I can’t give a good comparison of the two but tidyr works for me.</p>
<pre class="r"><code>CS_INV_long &lt;- gather(CS_INV, key = &quot;Group&quot;, value = &quot;Count&quot;, MITE1:COLL4)
head(CS_INV_long)</code></pre>
<pre><code>##           ID Group Count
## 1 GCEXWQRYRK MITE1     3
## 2 JZCMAHEPQY MITE1     5
## 3 DTVGQBSJIA MITE1     2
## 4 REJAJMVEIE MITE1     2
## 5 FMWEYMKIGS MITE1     0
## 6 KYULXCMWOJ MITE1     0</code></pre>
<pre class="r"><code>CS_INV_long &lt;- filter(CS_INV_long, Count &gt; 0)
head(CS_INV_long)</code></pre>
<pre><code>##           ID Group Count
## 1 GCEXWQRYRK MITE1     3
## 2 JZCMAHEPQY MITE1     5
## 3 DTVGQBSJIA MITE1     2
## 4 REJAJMVEIE MITE1     2
## 5 CPKKYGMVFP MITE1     5
## 6 TAYSUFTDEF MITE1     5</code></pre>
<p>To get back to wide format we use the spread function from the same package, specifying that we want all empty data combinations to be filled with zeros</p>
<pre class="r"><code>## long to wide format
CS_INV_2 &lt;- spread(CS_INV_long, key=Group, value=Count, fill=0)   ##tidyr
head(CS_INV_2)</code></pre>
<pre><code>##           ID COLL1 COLL2 COLL3 COLL4 MITE1 MITE2 MITE3 MITE4
## 1 AARNOEIXTK     1     7     5     3     0     1     7     3
## 2 AASEUFESNB     2     1     5     0     0     0     1     0
## 3 ABCYSBVXNC     1     1     2     0     0     0     4     0
## 4 ABEENBZIAU     1     2     1     7     4     3     0     1
## 5 ABMLDUMMAC     0     5     1     1     0     0     0     1
## 6 ABYSCFZCVH     2     3     8     1     0     1     0     2</code></pre>
</div>
<div id="combining-dataframes" class="section level2">
<h2>Combining dataframes</h2>
<p>We have two datasets with different measurements from the same plots, we can merge these together using the ID as a reference</p>
<p>within base R use the merge function. We specify the ID columns for both datasets (if they had the same name we could just set by = “that name”), we also specify that we want copies of all the rows, even if they have no corresponding match in the other data frame by setting all = TRUE</p>
<pre class="r"><code>CS_mer &lt;- merge(CS, CS_INV, by.x = &quot;plot_id&quot;, by.y = &quot;ID&quot;, all = TRUE)</code></pre>
<p>within dplyr the equivalent is the join set of commands</p>
<pre class="r"><code>CS_mer &lt;- full_join(CS, CS_INV, by = c(&quot;plot_id&quot; = &quot;ID&quot;)) #does the same as before
CS_mer &lt;- inner_join(CS, CS_INV, by = c(&quot;plot_id&quot; = &quot;ID&quot;)) #returns only the rows with matching values
CS_mer &lt;- left_join(CS, CS_INV, by = c(&quot;plot_id&quot; = &quot;ID&quot;))  #returns all the rows in the first dataframe and columns from both
CS_mer &lt;- right_join(CS, CS_INV, by = c(&quot;plot_id&quot; = &quot;ID&quot;)) #returns all the rows in the second dataframe and columns from both</code></pre>
<p>There are also filtering joins within dplyr where the command returns only the columns from the first dataframe but filters the rows so that only the rows that appear in the second dataframe are returned, or alternatively those that don’t appear with anti_join</p>
<pre class="r"><code>CS_join &lt;- semi_join(CS_INV, CS, by = c(&quot;ID&quot; = &quot;plot_id&quot;))
CS_join &lt;- anti_join(CS_INV, CS, by = c(&quot;ID&quot; = &quot;plot_id&quot;))</code></pre>
</div>
<div id="combining-multiple-operations-with-the-pipe" class="section level2">
<h2>Combining multiple operations with the pipe %&gt;%</h2>
<p>Say you want to create a long format dataframe with only the mites, and take the logarithm of the mite count. We could do this step by step as above, assigning a new object each time. However we can use the pipe to cut down on the amount of clutter in our R environment. The pipe %&gt;% tells R to take the thing on the left of the pipe and apply the operation on the right to it. This means multiple operations can be chained together, hopefully making life a little easier.</p>
<pre class="r"><code>CS_MITE_LONG &lt;- CS_INV %&gt;% select(ID, starts_with(&quot;MITE&quot;)) %&gt;%        #Takes the CS_INV dataframe and selects only the ID and mite column
  gather(key = &quot;Group&quot;, value = &quot;Count&quot;, starts_with(&quot;MITE&quot;)) %&gt;%     #convert to long format
  filter(Count &gt; 0) %&gt;%                                               #remove all zero count rows
  mutate(log_Count = log(Count))                                      #mutate adds columns, here it is the log of the mite count
head(CS_MITE_LONG)</code></pre>
<pre><code>##           ID Group Count log_Count
## 1 GCEXWQRYRK MITE1     3 1.0986123
## 2 JZCMAHEPQY MITE1     5 1.6094379
## 3 DTVGQBSJIA MITE1     2 0.6931472
## 4 REJAJMVEIE MITE1     2 0.6931472
## 5 CPKKYGMVFP MITE1     5 1.6094379
## 6 TAYSUFTDEF MITE1     5 1.6094379</code></pre>
<p>How about calculating total mite and collembola counts and adding to the previous dataset?</p>
<pre class="r"><code>CS_full &lt;- CS_INV %&gt;% 
  mutate(TOTAL_MITE = MITE1 + MITE2 + MITE3 + MITE4,
         TOTAL_COLL = COLL1 + COLL2 + COLL3 + COLL4) %&gt;%
  select(ID, TOTAL_MITE, TOTAL_COLL) %&gt;%
  full_join(CS, by=c(&quot;ID&quot; = &quot;plot_id&quot;))
head(CS_full)</code></pre>
<pre><code>##           ID TOTAL_MITE TOTAL_COLL country    county carbon_percent
## 1 GCEXWQRYRK          5         16     VAL    ERROLD       70.17699
## 2 JZCMAHEPQY          8          6     RET BOLTHAVEN       14.53870
## 3 DTVGQBSJIA          8          3     VAL   TREVALE       28.61449
## 4 REJAJMVEIE          2          0     HAR GREENVALE       23.99431
## 5 FMWEYMKIGS         10         22     VAL   EVENDIM       14.90282
## 6 KYULXCMWOJ         14         12     VAL   EVENDIM       57.77737
##   nitrogen_percent       ph habitat C_CAT
## 1         7.695723 2.852600       8   Org
## 2         1.533813 6.041698       7    HM
## 3         5.925866 5.003867       4    HM
## 4         1.640570 5.429147       2    HM
## 5         2.843174 6.851267       8    HM
## 6         6.886864 3.171440       6   Org</code></pre>
<p>If you’re interested in why the pipe has % signs on either side, it’s the syntax used in R to show it’s a function that does something with the things on either side of it. Another common example is %in% which tells you if the things in the object to the left are in the object to the right. e.g.</p>
<pre class="r"><code>c(1,3,5) %in% c(2,3,4)</code></pre>
<pre><code>## [1] FALSE  TRUE FALSE</code></pre>
<p>This is different to the usual R notation where you have a function with arguments declared within it.</p>
</div>
<div id="summary-tables-and-statistics" class="section level2">
<h2>Summary tables and statistics</h2>
<p>There’s a <em>lot</em> of different functions in R for summarising dataframes, so we’re going to go through a few useful ones</p>
<p>The summarytools package has a few useful functions, such as the summary table produced below:</p>
<pre class="r"><code>print(dfSummary(CS[,2:6], style = &#39;grid&#39;, graph.magnif = 0.85), method = &quot;render&quot;, omit.headings = TRUE)</code></pre>
<div class="container st-container">
<table class="table table-striped table-bordered st-table st-table-striped st-table-bordered st-multiline ">
  <thead>
    <tr>
      <th align="center"><strong>No</strong></th>
      <th align="center"><strong>Variable</strong></th>
      <th align="center"><strong>Stats / Values</strong></th>
      <th align="center"><strong>Freqs (% of Valid)</strong></th>
      <th align="center"><strong>Graph</strong></th>
      <th align="center"><strong>Valid</strong></th>
      <th align="center"><strong>Missing</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td align="center">1</td>
      <td align="left">country
[character]</td>
      <td align="left">1. HAR
2. RET
3. VAL</td>
      <td align="left">204 (20.4%)
311 (31.1%)
485 (48.5%)</td>
      <td align="center" border="0"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH8AAABCCAMAAABJh/lSAAAADFBMVEX9/v2mpqb39/f9/v0TNkn1AAAABHRSTlP///8AQCqp9AAAAGNJREFUaIHt1sEJwDAMA8C02X/nzhAjECWnBe5hGbR2N+t6/xkl6L+D8Pl8Pp/P/7df3h/d8Gf3T1Vj2P/Ya/D5fD6fz6/45f3RDT9+/6Pk+3/2LHw+n8/n86/0y/unvf+6+QAVWEz3Iz1CRAAAAABJRU5ErkJggg=="></td>
      <td align="center">1000
(100%)</td>
      <td align="center">0
(0%)</td>
    </tr>
    <tr>
      <td align="center">2</td>
      <td align="left">county
[character]</td>
      <td align="left">1. BERRYFORD
2. BOLTHAVEN
3. ERROLD
4. EVENDIM
5. GREENVALE
6. PETRAS
7. TREVALE</td>
      <td align="left">113 (11.3%)
165 (16.5%)
156 (15.6%)
185 (18.5%)
91 (9.1%)
146 (14.6%)
144 (14.4%)</td>
      <td align="center" border="0"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH8AAACaCAMAAAC36mcQAAAADFBMVEX9/v2mpqb39/f9/v0TNkn1AAAABHRSTlP///8AQCqp9AAAALxJREFUeJzt10EKwzAQBEEn+f+ffQsYcrEl1DGu+UDB7gpG26fNxuen/mtqLvjvieHz+Xw+n38PP+4fbfhz93/2RCbf/+knwufz+Xw+P/Hj/tGm96vJf/3o8vh8Pp/P5z/Yj/tPm95fOP8fWf//OZ4kn8/n8/n8xI/7R92/nu4PLnDcHztgPp/P5/P5d/Tj/tGm9wfnP7ikJf8fPp/P5/P5/KMf9582vZ+Of8n98fl8Pp/P/zs/7h9t+PwyO4k0rehZObwkAAAAAElFTkSuQmCC"></td>
      <td align="center">1000
(100%)</td>
      <td align="center">0
(0%)</td>
    </tr>
    <tr>
      <td align="center">3</td>
      <td align="left">carbon_percent
[numeric]</td>
      <td align="left">mean (sd) : 34.87 (16.4)
min &lt; med &lt; max :
4.42 &lt; 31.34 &lt; 105.24
IQR (CV) : 20.3 (0.47)</td>
      <td align="left">998 distinct values</td>
      <td align="center" border="0"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH8AAABVCAMAAABXVMtxAAAADFBMVEX9/v2mpqby8vL9/v28xacEAAAABHRSTlP///8AQCqp9AAAAJlJREFUaIHt2NEKgzAMBVDX/f8/DwSZDwFtjY1j5z4q9Mgl0ODyrs3Cf6r/+qbGb1v4fD6fz+cX+PetAuf8dlsVfD6fz+fz+dX+ftUq8VugPslPXkW7/eQq+Hw+n8/n/5afsYlc8TOa4PP5fD5/3B+/CnP83UN+rd85Cul+ZxWrH/50m+mPnX/0PsxE/+ijwv4nJpq/2fl3/wPbLnCJyleYZwAAAABJRU5ErkJggg=="></td>
      <td align="center">999
(99.9%)</td>
      <td align="center">1
(0.1%)</td>
    </tr>
    <tr>
      <td align="center">4</td>
      <td align="left">nitrogen_percent
[numeric]</td>
      <td align="left">mean (sd) : 4.76 (2.05)
min &lt; med &lt; max :
0.02 &lt; 4.61 &lt; 12.71
IQR (CV) : 2.68 (0.43)</td>
      <td align="left">992 distinct values</td>
      <td align="center" border="0"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH8AAABVCAMAAABXVMtxAAAADFBMVEX9/v2mpqby8vL9/v28xacEAAAABHRSTlP///8AQCqp9AAAAKVJREFUaIHt2tEKgCAMhWGz93/nIEKhIt2czvA/V9LNRydjBoXdNwF/an97Zqwfr+QFPj4+Pr6PbzoIFL5pEfj4+Pj4+FLfYhK2+DGt8PFN/by1nfwKFh8fHx8fHx/f0dd/CNj4+iLm8kXHzh6+hMXHx8fHz5fEg9DYFxeBj9/Dr30RTl937Pn0a4sI+tv+h194EN39QhHr+O8/kt32/9Ak3zGr+wfP1mzSrTrGVwAAAABJRU5ErkJggg=="></td>
      <td align="center">996
(99.6%)</td>
      <td align="center">4
(0.4%)</td>
    </tr>
    <tr>
      <td align="center">5</td>
      <td align="left">ph
[numeric]</td>
      <td align="left">mean (sd) : 4.49 (1)
min &lt; med &lt; max :
1.53 &lt; 4.51 &lt; 7.53
IQR (CV) : 1.33 (0.22)</td>
      <td align="left">998 distinct values</td>
      <td align="center" border="0"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH8AAABVCAMAAABXVMtxAAAADFBMVEX9/v2mpqby8vL9/v28xacEAAAABHRSTlP///8AQCqp9AAAAKFJREFUaIHt19EKgCAMhWHN93/nIEgvzJwyt6T/XIsfDHUzJN8E/F39WOLjH3fw8fGN/HLrnfys4uPj4/v784OQjj9fiG38uu0Y+zWGj4+Pj4+Pj4+v77+MfTZ+m8XH/5o//BFV9ocLgY+Pj4+Pr+lLG+EqX1qIhi8Ze5f6kq3x8fE7izoP0XK/U4jLj3Vs/aGN8Lf0ny9C6/xZJPuO+bt/AgOIbaZyxqS8AAAAAElFTkSuQmCC"></td>
      <td align="center">999
(99.9%)</td>
      <td align="center">1
(0.1%)</td>
    </tr>
  </tbody>
</table>
<p>Generated by <a href='https://github.com/dcomtois/summarytools'>summarytools</a> 0.8.8 (<a href='https://www.r-project.org/'>R</a> version 3.5.1)<br/>2018-11-14</p>
</div>
<div id="frequency-tables-and-cross-tabulating-factors" class="section level3">
<h3>Frequency tables and cross-tabulating factors</h3>
<p>Both janitor and summarytools offer functions for frequency tables and cross-tabulating factors.</p>
<pre class="r"><code>freq(CS$habitat, style = &quot;rmarkdown&quot;, omit.headings = TRUE) ##summarytools</code></pre>
<table>
<thead>
<tr class="header">
<th align="right"> </th>
<th align="right">Freq</th>
<th align="right">% Valid</th>
<th align="right">% Valid Cum.</th>
<th align="right">% Total</th>
<th align="right">% Total Cum.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><strong>1</strong></td>
<td align="right">95</td>
<td align="right">9.50</td>
<td align="right">9.50</td>
<td align="right">9.50</td>
<td align="right">9.50</td>
</tr>
<tr class="even">
<td align="right"><strong>2</strong></td>
<td align="right">107</td>
<td align="right">10.70</td>
<td align="right">20.20</td>
<td align="right">10.70</td>
<td align="right">20.20</td>
</tr>
<tr class="odd">
<td align="right"><strong>3</strong></td>
<td align="right">95</td>
<td align="right">9.50</td>
<td align="right">29.70</td>
<td align="right">9.50</td>
<td align="right">29.70</td>
</tr>
<tr class="even">
<td align="right"><strong>4</strong></td>
<td align="right">109</td>
<td align="right">10.90</td>
<td align="right">40.60</td>
<td align="right">10.90</td>
<td align="right">40.60</td>
</tr>
<tr class="odd">
<td align="right"><strong>5</strong></td>
<td align="right">106</td>
<td align="right">10.60</td>
<td align="right">51.20</td>
<td align="right">10.60</td>
<td align="right">51.20</td>
</tr>
<tr class="even">
<td align="right"><strong>6</strong></td>
<td align="right">99</td>
<td align="right">9.90</td>
<td align="right">61.10</td>
<td align="right">9.90</td>
<td align="right">61.10</td>
</tr>
<tr class="odd">
<td align="right"><strong>7</strong></td>
<td align="right">106</td>
<td align="right">10.60</td>
<td align="right">71.70</td>
<td align="right">10.60</td>
<td align="right">71.70</td>
</tr>
<tr class="even">
<td align="right"><strong>8</strong></td>
<td align="right">99</td>
<td align="right">9.90</td>
<td align="right">81.60</td>
<td align="right">9.90</td>
<td align="right">81.60</td>
</tr>
<tr class="odd">
<td align="right"><strong>9</strong></td>
<td align="right">105</td>
<td align="right">10.50</td>
<td align="right">92.10</td>
<td align="right">10.50</td>
<td align="right">92.10</td>
</tr>
<tr class="even">
<td align="right"><strong>10</strong></td>
<td align="right">79</td>
<td align="right">7.90</td>
<td align="right">100.00</td>
<td align="right">7.90</td>
<td align="right">100.00</td>
</tr>
<tr class="odd">
<td align="right"><strong>&lt;NA&gt;</strong></td>
<td align="right">0</td>
<td align="right"></td>
<td align="right"></td>
<td align="right">0.00</td>
<td align="right">100.00</td>
</tr>
<tr class="even">
<td align="right"><strong>Total</strong></td>
<td align="right">1000</td>
<td align="right">100.00</td>
<td align="right">100.00</td>
<td align="right">100.00</td>
<td align="right">100.00</td>
</tr>
</tbody>
</table>
<pre class="r"><code>print(ctable(CS$country, CS$county, prop = &quot;n&quot;), method = &quot;render&quot;, omit.headings = TRUE) ##summarytools</code></pre>
<div class="container st-container">
<table class="table table-bordered st-table st-table-bordered st-cross-table ">
<thead>
<tr>
<th></th>
<th colspan="7">county</th>
<th></th>
</tr>
<tr>
<td align="center">
<strong>country</strong>
</td>
<th align="center">BERRYFORD</th>
<th align="center">BOLTHAVEN</th>
<th align="center">ERROLD</th>
<th align="center">EVENDIM</th>
<th align="center">GREENVALE</th>
<th align="center">PETRAS</th>
<th align="center">TREVALE</th>
<th align="center">Total</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">
<strong>HAR</strong>
</td>
<td>
<span>113</span>
</td>
<td>
<span>0</span>
</td>
<td>
<span>0</span>
</td>
<td>
<span>0</span>
</td>
<td>
<span>91</span>
</td>
<td>
<span>0</span>
</td>
<td>
<span>0</span>
</td>
<td>
<span>204</span>
</td>
</tr>
<tr>
<td align="center">
<strong>RET</strong>
</td>
<td>
<span>0</span>
</td>
<td>
<span>165</span>
</td>
<td>
<span>0</span>
</td>
<td>
<span>0</span>
</td>
<td>
<span>0</span>
</td>
<td>
<span>146</span>
</td>
<td>
<span>0</span>
</td>
<td>
<span>311</span>
</td>
</tr>
<tr>
<td align="center">
<strong>VAL</strong>
</td>
<td>
<span>0</span>
</td>
<td>
<span>0</span>
</td>
<td>
<span>156</span>
</td>
<td>
<span>185</span>
</td>
<td>
<span>0</span>
</td>
<td>
<span>0</span>
</td>
<td>
<span>144</span>
</td>
<td>
<span>485</span>
</td>
</tr>
<tr>
<td align="center">
<strong>Total</strong>
</td>
<td>
<span>113</span>
</td>
<td>
<span>165</span>
</td>
<td>
<span>156</span>
</td>
<td>
<span>185</span>
</td>
<td>
<span>91</span>
</td>
<td>
<span>146</span>
</td>
<td>
<span>144</span>
</td>
<td>
<span>1000</span>
</td>
</tr>
</tbody>
</table>
<p>Generated by <a href='https://github.com/dcomtois/summarytools'>summarytools</a> 0.8.8 (<a href='https://www.r-project.org/'>R</a> version 3.5.1)<br/>2018-11-14</p>
</div>
<p>For me janitor is a little more intuitive, and is also built to be compatible with the pipe operator</p>
<pre class="r"><code>tabyl(CS, habitat)</code></pre>
<pre><code>##  habitat   n percent
##        1  95   0.095
##        2 107   0.107
##        3  95   0.095
##        4 109   0.109
##        5 106   0.106
##        6  99   0.099
##        7 106   0.106
##        8  99   0.099
##        9 105   0.105
##       10  79   0.079</code></pre>
<pre class="r"><code>tabyl(CS, country, county) </code></pre>
<pre><code>##  country BERRYFORD BOLTHAVEN ERROLD EVENDIM GREENVALE PETRAS TREVALE
##      HAR       113         0      0       0        91      0       0
##      RET         0       165      0       0         0    146       0
##      VAL         0         0    156     185         0      0     144</code></pre>
<pre class="r"><code>tabyl(CS, country, habitat, county)</code></pre>
<pre><code>## $BERRYFORD
##  country  1  2 3  4  5 6  7  8  9 10
##      HAR 10 14 9 12 10 9 12 13 17  7
##      RET  0  0 0  0  0 0  0  0  0  0
##      VAL  0  0 0  0  0 0  0  0  0  0
## 
## $BOLTHAVEN
##  country  1  2  3  4  5  6  7  8  9 10
##      HAR  0  0  0  0  0  0  0  0  0  0
##      RET 17 16 19 16 20 13 20 15 14 15
##      VAL  0  0  0  0  0  0  0  0  0  0
## 
## $ERROLD
##  country  1  2  3  4  5  6  7  8  9 10
##      HAR  0  0  0  0  0  0  0  0  0  0
##      RET  0  0  0  0  0  0  0  0  0  0
##      VAL 16 16 12 18 17 17 15 20 15 10
## 
## $EVENDIM
##  country  1  2  3  4  5  6  7  8  9 10
##      HAR  0  0  0  0  0  0  0  0  0  0
##      RET  0  0  0  0  0  0  0  0  0  0
##      VAL 16 16 22 20 24 11 15 20 22 19
## 
## $GREENVALE
##  country  1  2  3 4 5  6 7 8 9 10
##      HAR 11 14 16 6 4 16 8 4 6  6
##      RET  0  0  0 0 0  0 0 0 0  0
##      VAL  0  0  0 0 0  0 0 0 0  0
## 
## $PETRAS
##  country  1  2 3  4  5  6  7 8  9 10
##      HAR  0  0 0  0  0  0  0 0  0  0
##      RET 12 15 9 17 18 12 21 7 18 17
##      VAL  0  0 0  0  0  0  0 0  0  0
## 
## $TREVALE
##  country  1  2 3  4  5  6  7  8  9 10
##      HAR  0  0 0  0  0  0  0  0  0  0
##      RET  0  0 0  0  0  0  0  0  0  0
##      VAL 13 16 8 20 13 21 15 20 13  5</code></pre>
</div>
<div id="summary-statistics-by-groups" class="section level3">
<h3>Summary statistics by groups</h3>
<p>dataframes can be described by a categorical variable within both summarytools and psych. The describeBy function in psych is simple to write but only likes numeric variables. I also don’t know of any way to pick and choose which stats are reported.</p>
<pre class="r"><code>describeBy(CS, &quot;country&quot;)</code></pre>
<pre><code>## 
##  Descriptive statistics by group 
## country: HAR
##                  vars   n  mean    sd median trimmed   mad  min   max
## plot_id*            1 204   NaN    NA     NA     NaN    NA  Inf  -Inf
## country*            2 204   NaN    NA     NA     NaN    NA  Inf  -Inf
## county*             3 204   NaN    NA     NA     NaN    NA  Inf  -Inf
## carbon_percent      4 203 34.28 16.07  31.09   32.43 14.31 8.97 98.90
## nitrogen_percent    5 202  3.49  1.93   3.26    3.34  1.82 0.02 10.33
## ph                  6 204  4.52  0.99   4.56    4.52  0.91 1.63  6.98
## habitat             7 204  5.18  2.85   5.00    5.15  3.71 1.00 10.00
## C_CAT*              8 203  3.10  0.98   3.00    3.25  1.48 1.00  4.00
##                  range  skew kurtosis   se
## plot_id*          -Inf    NA       NA   NA
## country*          -Inf    NA       NA   NA
## county*           -Inf    NA       NA   NA
## carbon_percent   89.93  1.29     2.19 1.13
## nitrogen_percent 10.31  0.80     0.83 0.14
## ph                5.35 -0.09     0.19 0.07
## habitat           9.00  0.11    -1.29 0.20
## C_CAT*            3.00 -1.09     0.27 0.07
## -------------------------------------------------------- 
## country: RET
##                  vars   n  mean    sd median trimmed   mad  min   max
## plot_id*            1 311   NaN    NA     NA     NaN    NA  Inf  -Inf
## country*            2 311   NaN    NA     NA     NaN    NA  Inf  -Inf
## county*             3 311   NaN    NA     NA     NaN    NA  Inf  -Inf
## carbon_percent      4 311 35.36 16.73  32.57   33.59 15.08 7.23 95.20
## nitrogen_percent    5 310  4.55  1.93   4.28    4.45  1.83 0.02 10.62
## ph                  6 311  4.46  1.02   4.49    4.47  1.03 1.72  7.53
## habitat             7 311  5.52  2.84   5.00    5.52  2.97 1.00 10.00
## C_CAT*              8 311  2.98  1.06   3.00    3.10  1.48 1.00  4.00
##                  range  skew kurtosis   se
## plot_id*          -Inf    NA       NA   NA
## country*          -Inf    NA       NA   NA
## county*           -Inf    NA       NA   NA
## carbon_percent   87.97  1.03     1.09 0.95
## nitrogen_percent 10.60  0.50     0.17 0.11
## ph                5.81 -0.08    -0.14 0.06
## habitat           9.00  0.01    -1.18 0.16
## C_CAT*            3.00 -0.90    -0.41 0.06
## -------------------------------------------------------- 
## country: VAL
##                  vars   n  mean    sd median trimmed   mad  min    max
## plot_id*            1 485   NaN    NA     NA     NaN    NA  Inf   -Inf
## country*            2 485   NaN    NA     NA     NaN    NA  Inf   -Inf
## county*             3 485   NaN    NA     NA     NaN    NA  Inf   -Inf
## carbon_percent      4 485 34.80 16.36  31.34   33.14 13.93 4.42 105.24
## nitrogen_percent    5 484  5.43  1.89   5.26    5.31  1.88 1.07  12.71
## ph                  6 484  4.49  1.00   4.52    4.50  0.98 1.53   7.29
## habitat             7 485  5.46  2.76   5.00    5.48  2.97 1.00  10.00
## C_CAT*              8 481  3.08  0.99   3.00    3.23  1.48 1.00   4.00
##                   range  skew kurtosis   se
## plot_id*           -Inf    NA       NA   NA
## country*           -Inf    NA       NA   NA
## county*            -Inf    NA       NA   NA
## carbon_percent   100.82  1.18     2.02 0.74
## nitrogen_percent  11.64  0.72     0.87 0.09
## ph                 5.76 -0.11     0.09 0.05
## habitat            9.00 -0.02    -1.18 0.13
## C_CAT*             3.00 -1.07     0.16 0.05</code></pre>
<p>summarytools’ version is longer to write but appears to be more flexible. I’ve set some parameters here to make it print better on this document - you may want to remove the style and method arguments to make it look nicer when working from the console.</p>
<pre class="r"><code>## summarytools&#39;s version is longer to write but more flexible
# First save the results
CS_stats_by_country &lt;- by(data = CS, 
                          INDICES = CS$country, 
                          FUN = descr, stats = c(&quot;mean&quot;, &quot;sd&quot;, &quot;min&quot;, &quot;med&quot;, &quot;max&quot;), 
                          transpose = TRUE, style = &quot;rmarkdown&quot;, omit.headings = TRUE)
# then view
view(CS_stats_by_country, method = &quot;pander&quot;)</code></pre>
<p><strong>Group:</strong> country = HAR<br />
<strong>N:</strong> 204</p>
<table>
<thead>
<tr class="header">
<th align="right"> </th>
<th align="right">Mean</th>
<th align="right">Std.Dev</th>
<th align="right">Min</th>
<th align="right">Median</th>
<th align="right">Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><strong>carbon_percent</strong></td>
<td align="right">34.28</td>
<td align="right">16.07</td>
<td align="right">8.97</td>
<td align="right">31.09</td>
<td align="right">98.90</td>
</tr>
<tr class="even">
<td align="right"><strong>nitrogen_percent</strong></td>
<td align="right">3.49</td>
<td align="right">1.93</td>
<td align="right">0.02</td>
<td align="right">3.26</td>
<td align="right">10.33</td>
</tr>
<tr class="odd">
<td align="right"><strong>ph</strong></td>
<td align="right">4.52</td>
<td align="right">0.99</td>
<td align="right">1.63</td>
<td align="right">4.56</td>
<td align="right">6.98</td>
</tr>
<tr class="even">
<td align="right"><strong>habitat</strong></td>
<td align="right">5.18</td>
<td align="right">2.85</td>
<td align="right">1.00</td>
<td align="right">5.00</td>
<td align="right">10.00</td>
</tr>
</tbody>
</table>
<p><strong>Group:</strong> country = RET<br />
<strong>N:</strong> 311</p>
<table>
<thead>
<tr class="header">
<th align="right"> </th>
<th align="right">Mean</th>
<th align="right">Std.Dev</th>
<th align="right">Min</th>
<th align="right">Median</th>
<th align="right">Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><strong>carbon_percent</strong></td>
<td align="right">35.36</td>
<td align="right">16.73</td>
<td align="right">7.23</td>
<td align="right">32.57</td>
<td align="right">95.20</td>
</tr>
<tr class="even">
<td align="right"><strong>nitrogen_percent</strong></td>
<td align="right">4.55</td>
<td align="right">1.93</td>
<td align="right">0.02</td>
<td align="right">4.28</td>
<td align="right">10.62</td>
</tr>
<tr class="odd">
<td align="right"><strong>ph</strong></td>
<td align="right">4.46</td>
<td align="right">1.02</td>
<td align="right">1.72</td>
<td align="right">4.49</td>
<td align="right">7.53</td>
</tr>
<tr class="even">
<td align="right"><strong>habitat</strong></td>
<td align="right">5.52</td>
<td align="right">2.84</td>
<td align="right">1.00</td>
<td align="right">5.00</td>
<td align="right">10.00</td>
</tr>
</tbody>
</table>
<p><strong>Group:</strong> country = VAL<br />
<strong>N:</strong> 485</p>
<table>
<thead>
<tr class="header">
<th align="right"> </th>
<th align="right">Mean</th>
<th align="right">Std.Dev</th>
<th align="right">Min</th>
<th align="right">Median</th>
<th align="right">Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><strong>carbon_percent</strong></td>
<td align="right">34.80</td>
<td align="right">16.36</td>
<td align="right">4.42</td>
<td align="right">31.34</td>
<td align="right">105.24</td>
</tr>
<tr class="even">
<td align="right"><strong>nitrogen_percent</strong></td>
<td align="right">5.43</td>
<td align="right">1.89</td>
<td align="right">1.07</td>
<td align="right">5.26</td>
<td align="right">12.71</td>
</tr>
<tr class="odd">
<td align="right"><strong>ph</strong></td>
<td align="right">4.49</td>
<td align="right">1.00</td>
<td align="right">1.53</td>
<td align="right">4.52</td>
<td align="right">7.29</td>
</tr>
<tr class="even">
<td align="right"><strong>habitat</strong></td>
<td align="right">5.46</td>
<td align="right">2.76</td>
<td align="right">1.00</td>
<td align="right">5.00</td>
<td align="right">10.00</td>
</tr>
</tbody>
</table>
<p>You can do the above using group_by() then summarise() from the dplyr package but as far as I know you’ll have to manually write out which stats you want which can be a hassle:</p>
<pre class="r"><code>CS %&gt;% group_by(country) %&gt;%
  summarise(mean_pH = mean(ph, na.rm = TRUE),
            mean_carbon = mean(carbon_percent, na.rm = TRUE))</code></pre>
<pre><code>## # A tibble: 3 x 3
##   country mean_pH mean_carbon
##   &lt;chr&gt;     &lt;dbl&gt;       &lt;dbl&gt;
## 1 HAR        4.52        34.3
## 2 RET        4.46        35.4
## 3 VAL        4.49        34.8</code></pre>
</div>
</div>
<div id="quick-graphs" class="section level2">
<h2>Quick graphs</h2>
<p>While summary statistic tables can be very useful they are no substitute for plotting out your data. For an interesting discussion about this (with dinosaurs!) see <a href="https://www.autodeskresearch.com/publications/samestats">this page on how different datasets can be with the same summary statistics.</a></p>
<p>Histograms are great for seeing what kind of distributions your variables have, I often use the multi.hist function from within the psych package to look at my data quickly and easily. Note that this function doesn’t always return the plotting environment to what it was previously so we specify that the plotting parameters should return to one plot per page afterwards</p>
<pre class="r"><code>multi.hist(CS[,4:6])</code></pre>
<p><img src="/tutorial/data_manipulation_files/figure-html/histogram-1.png" width="672" /></p>
<pre class="r"><code>par(mfrow=c(1,1)) </code></pre>
<p>The pairs plot within R, and the extensions upon it from many other package, is a great way to see how the variables from your dataset are related to each other.The pairs.panels function in psych shows the name of each variable and its histogram down the diagonal, the scatterplots on the lower triangle and the correlation coefficient on the upper triangle. You can change the type of correlation coefficient, and various plotting parameters easily.</p>
<pre class="r"><code>pairs.panels(CS[,4:6])</code></pre>
<p><img src="/tutorial/data_manipulation_files/figure-html/pairsplot-1.png" width="672" /></p>
<p>If you want to take an in depth look at one of the plots and identify certain points then you can plot the scatterplot and use the identify function to interactively select points and get a label for what they are - this doesn’t work in rmarkdown but you can try it yourself.</p>
<pre class="r"><code>plot(nitrogen_percent ~ carbon_percent, CS)
identify(CS$carbon_percent, CS$nitrogen_percent, labels=CS$plot_id)</code></pre>
<p><img src="/tutorial/data_manipulation_files/figure-html/identify-1.png" width="672" /></p>
<p>Other useful plots include coplots in base R, which show how the relationship between two variables changes with a third variable</p>
<pre class="r"><code>coplot(ph ~ carbon_percent|nitrogen_percent, CS)</code></pre>
<p><img src="/tutorial/data_manipulation_files/figure-html/coplot-1.png" width="672" /></p>
<p>That’s all that comes to mind right now. There are <strong><em>so many</em></strong> different ways of manipulating and exploring datasets in R. These are just a few that I have found useful and I hope you do too!</p>
</div>
